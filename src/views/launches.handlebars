
{{#if launches.list}}
    <h4 style="text-align: center; margin-top: 20px; margin-bottom: 30px;">Launches</h4>
{{else}}
    <h4 style="text-align: center; margin-top: 20px; margin-bottom: 30px;">No tests launches</h4>
{{/if}}

<ul class="list-group" style="margin-left: auto; margin-right: auto; max-width: 900px;">
    {{#each launches.list}}
        <a href="/launch/{{this._id}}" class="list-group-item list-group-item-action" style="padding-left: 32px; padding-right: 32px;">
            <div class="d-flex w-100 justify-content-between">
                {{this.launchName}}
                <span class="text-muted">{{this.launchDateLocal}}</span>
            </div>
            <!--<p class="mb-1">Passed 8</p>-->
            <!--<p class="mb-1">Failed 3</p>-->
            <!--<small>Lasted for 4s</small>-->
        </a>
    {{/each}}
</ul>

<div class="modal fade" id="delete-project" tabindex="-1" role="dialog" aria-labelledby="delete-project-label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="delete-project-label">Delete project</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                All project launches will be deleted
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary delete-project-button" value="{{launches.projectId}}" onclick="deleteProject(this.value);">
                    Delete project
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="project-modal" tabindex="-1" role="dialog" aria-labelledby="project-modal-label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body" style="text-align: center">
                <br>
                <h6 class="modal-title" id="project-modalLabel">Put this id in your reporter client config:</h6>
                <br>
                <p>{{launches.projectId}}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="modal" data-target="#delete-project">
                    Delete project
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    function deleteProject(projectId){
        $('#delete-project').on('hidden.bs.modal', function(e) {
            $('.delete-project-button').val('');
            document.location.href= '/projects'
        });

        const xhr = new XMLHttpRequest();
        xhr.open("DELETE", `/project/${projectId}`, true);
        xhr.onload = function (){
            if (xhr.status === 200){
                $('#delete-project').modal('hide');
            } else {
                console.error(xhr.status);
                $('#delete-project').modal('hide');
            }
        };
        xhr.onerror = xhr.onabort = function (){
            console.error('some error');
        };
        xhr.send();
    }

    let eventSource = new EventSource('/launches-update/{{launches.projectId}}');

    eventSource.onmessage = function(e) {
        document.location.reload()
    };
</script>